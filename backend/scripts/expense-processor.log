2025-06-29 11:37:49,882 [INFO] - Loading environment variables from: C:\Users\mehdi\code\patchline_v1\.env.local
2025-06-29 11:37:49,884 [INFO] - [SUCCESS] Loaded AWS credentials: ACCESS_KEY_ID=**********
2025-06-29 11:37:49,884 [INFO] - [SUCCESS] Secret key found: **********
2025-06-29 11:37:49,998 [INFO] - Successfully imported Bedrock model config. Primary model: anthropic.claude-sonnet-4-20250514-v1:0
2025-06-29 11:37:50,172 [INFO] - Found credentials in shared credentials file: ~/.aws/credentials
2025-06-29 11:37:50,196 [INFO] - Starting expense processor server on port 8000 with Waitress...
2025-06-29 11:37:50,204 [INFO] - Serving on http://127.0.0.1:8000
2025-06-29 11:39:50,970 [INFO] - 
========================================
2025-06-29 11:39:50,971 [INFO] - EXPENSE PROCESSOR SERVER - NEW REQUEST
2025-06-29 11:39:50,971 [INFO] - ========================================
2025-06-29 11:39:50,975 [INFO] - Request Details:
2025-06-29 11:39:50,975 [INFO] -    User ID: default-user
2025-06-29 11:39:50,975 [INFO] -    Document ID: doc_1751211582520_um2exv
2025-06-29 11:39:50,975 [INFO] -    Bank Type: amazon-receipts
2025-06-29 11:39:50,975 [INFO] -    Textract Blocks: 460
2025-06-29 11:39:50,976 [INFO] -    Text Length: 2021
2025-06-29 11:39:50,976 [INFO] - Starting expense parsing...
2025-06-29 11:39:50,976 [INFO] - Calling parser.parse_textract_output()...
2025-06-29 11:39:50,976 [INFO] - Amazon Receipt Parser - Redirecting to Gmail parser for email prints
2025-06-29 11:39:50,977 [INFO] - 
========================================
2025-06-29 11:39:50,977 [INFO] - GMAIL RECEIPT PARSER - ENTRY POINT
2025-06-29 11:39:50,977 [INFO] - ========================================
2025-06-29 11:39:50,977 [INFO] - Document ID: doc_1751211582520_um2exv
2025-06-29 11:39:50,977 [INFO] - User ID: default-user
2025-06-29 11:39:50,977 [INFO] - Gmail receipt - Processing 81 lines
2025-06-29 11:39:50,978 [INFO] - Total text content length: 2020 characters
2025-06-29 11:39:50,978 [INFO] - 
=== First 20 lines of Gmail receipt ===
2025-06-29 11:39:50,978 [INFO] - 0: Gmail
2025-06-29 11:39:50,978 [INFO] - 1: Mehdi <mehdi.noori7@gmail.com>
2025-06-29 11:39:50,979 [INFO] - 2: Your Amazon.com order of "Airloons 9.5in Standard..." and 3 more items.
2025-06-29 11:39:50,979 [INFO] - 3: 1 message
2025-06-29 11:39:50,979 [INFO] - 4: Amazon.com <auto-confirm@amazon.com>
2025-06-29 11:39:50,980 [INFO] - 5: Wed, Dec 25, 2024 at 4:38 AM
2025-06-29 11:39:50,980 [INFO] - 6: Reply-To: no-reply@amazon.com
2025-06-29 11:39:50,980 [INFO] - 7: To: mehdi.noori7@gmail.com
2025-06-29 11:39:50,980 [INFO] - 8: amazon
2025-06-29 11:39:50,980 [INFO] - 9: Hello Mehdi,
2025-06-29 11:39:50,981 [INFO] - 10: Thank you for shopping with us. We'll send a confirmation when your
2025-06-29 11:39:50,981 [INFO] - 11: items ship.
2025-06-29 11:39:50,981 [INFO] - 12: Your purchase has been divided into 2 orders.
2025-06-29 11:39:50,981 [INFO] - 13: Order Confirmation
2025-06-29 11:39:50,981 [INFO] - 14: Arriving:
2025-06-29 11:39:50,981 [INFO] - 15: Friday, December 27
2025-06-29 11:39:50,982 [INFO] - 16: Ship to:
2025-06-29 11:39:50,982 [INFO] - 17: Mehdi
2025-06-29 11:39:50,982 [INFO] - 18: BROOKLYN, NY
2025-06-29 11:39:50,982 [INFO] - 19: Order #
2025-06-29 11:39:50,982 [INFO] - === End sample ===

2025-06-29 11:39:50,982 [INFO] - Detected receipt type: generic
2025-06-29 11:39:50,982 [INFO] - Detected Amazon email receipt - looking for multiple orders
2025-06-29 11:39:50,982 [INFO] - Found 6 order sections in Amazon email
2025-06-29 11:39:50,982 [INFO] - 
Processing order section 1:
2025-06-29 11:39:50,983 [INFO] - Section preview: Order Confirmation
Arriving:
Friday, December 27
Ship to:
Mehdi
BROOKLYN, NY...
2025-06-29 11:39:50,984 [INFO] - Using email date: 2024-12-25
2025-06-29 11:39:50,984 [WARNING] - Could not extract complete details from order section 1
2025-06-29 11:39:50,984 [INFO] - 
Processing order section 2:
2025-06-29 11:39:50,984 [INFO] - Section preview: Order #
114-6552244-5821058
View or manage order
116
116 Pcs Party Favors for Ki...
Qty 1
Arriving:
Saturday, December 28
Ship to:
Mehdi
BROOKLYN, NY...
2025-06-29 11:39:50,985 [INFO] - Found order number: 114-6552244-5821058
2025-06-29 11:39:50,985 [INFO] - Found product description: 116 Pcs Party Favors for Ki...
2025-06-29 11:39:50,986 [INFO] - Using email date: 2024-12-25
2025-06-29 11:39:50,986 [WARNING] - Could not extract complete details from order section 2
2025-06-29 11:39:50,986 [INFO] - 
Processing order section 3:
2025-06-29 11:39:50,987 [INFO] - Section preview: Order #
114-6552244-5821058
View or manage order
Black and Metallic Gold Bal...
Qty : 1
Arriving:
Sunday, December 29
Ship to:
Mehdi
BROOKLYN, NY...
2025-06-29 11:39:50,987 [INFO] - Found order number: 114-6552244-5821058
2025-06-29 11:39:50,988 [INFO] - Found product description: Black and Metallic Gold Bal...
2025-06-29 11:39:50,988 [INFO] - Using email date: 2024-12-25
2025-06-29 11:39:50,988 [WARNING] - Could not extract complete details from order section 3
2025-06-29 11:39:50,989 [INFO] - 
Processing order section 4:
2025-06-29 11:39:50,989 [INFO] - Section preview: Order #
114-6552244-5821058
View or manage order
50 pcs
Non-flashing
50 LED Light Up Balloons Mi...
Qty 1
Order Total:
$44.50...
2025-06-29 11:39:50,989 [INFO] - Found order number: 114-6552244-5821058
2025-06-29 11:39:50,989 [INFO] - Found order total: $44.50
2025-06-29 11:39:50,990 [INFO] - Found product description: 50 LED Light Up Balloons Mi...
2025-06-29 11:39:50,991 [INFO] - Using email date: 2024-12-25
2025-06-29 11:39:50,991 [INFO] - 
[AI] STARTING AI DESCRIPTION GENERATION
2025-06-29 11:39:50,991 [INFO] - [AI] Bedrock client status: Available
2025-06-29 11:39:50,991 [INFO] - [AI] Input vendor: Amazon.com
2025-06-29 11:39:50,991 [INFO] - [AI] Input amount: $44.5
2025-06-29 11:39:50,992 [INFO] - [AI] Input text length: 106 characters
2025-06-29 11:39:50,992 [INFO] - 
[AI] Preparing Bedrock prompt for description generation ===
2025-06-29 11:39:50,992 [INFO] - [AI] Vendor: Amazon.com, Amount: $44.5
2025-06-29 11:39:50,992 [INFO] - [AI] Text preview (first 200 chars): Amazon.com email receipt
Order: 114-6552244-5821058
Products: 50 LED Light Up Balloons Mi...
Total: $44.50...
2025-06-29 11:39:50,993 [INFO] - [AI] Candidate models to try (ordered): ['anthropic.claude-sonnet-4-20250514-v1:0', 'us.anthropic.claude-sonnet-4-20250514-v1:0', 'us.anthropic.claude-3-7-sonnet-20250219-v1:0', 'arn:aws:bedrock:us-east-1::inference-profile/us.amazon.nova-premier-v1:0', 'amazon.nova-premier-v1:0', 'amazon.nova-micro-v1:0', 'anthropic.claude-3-haiku-20240307-v1:0']
2025-06-29 11:39:50,993 [INFO] - [AI] Attempting Bedrock call with model: anthropic.claude-sonnet-4-20250514-v1:0
2025-06-29 11:39:51,153 [ERROR] - [AI] Error invoking model anthropic.claude-sonnet-4-20250514-v1:0: An error occurred (ValidationException) when calling the InvokeModel operation: Invocation of model ID anthropic.claude-sonnet-4-20250514-v1:0 with on-demand throughput isnâ€™t supported. Retry your request with the ID or ARN of an inference profile that contains this model.
2025-06-29 11:39:51,155 [INFO] - [AI] Attempting Bedrock call with model: us.anthropic.claude-sonnet-4-20250514-v1:0
2025-06-29 11:39:53,028 [INFO] - [AI] Received response from Bedrock (model us.anthropic.claude-sonnet-4-20250514-v1:0)
2025-06-29 11:39:53,029 [INFO] - [AI] AI Generated description: 'Office Expenses - Live Performance Materials - LED Light Up Balloons for Audiovisual Shows - Order 114-6552244-5821058' (len=118)
2025-06-29 11:39:53,029 [INFO] - [AI] Cleaned description: 'Office Expenses - Live Performance Materials - LED Light Up Balloons for Audiovisual Shows - Order 114-6552244-5821058'
2025-06-29 11:39:53,029 [INFO] - Added Amazon order: Office Expenses - Live Performance Materials - LED Light Up Balloons for Audiovisual Shows - Order 114-6552244-5821058 - $44.50
2025-06-29 11:39:53,029 [INFO] - 
Processing order section 5:
2025-06-29 11:39:53,030 [INFO] - Section preview: Order Confirmation
Arriving:
Monday, December 30 -
Tuesday, December 31
Ship to:
Mehdi
BROOKLYN, NY...
2025-06-29 11:39:53,030 [INFO] - Using email date: 2024-12-25
2025-06-29 11:39:53,030 [WARNING] - Could not extract complete details from order section 5
2025-06-29 11:39:53,030 [INFO] - 
Processing order section 6:
2025-06-29 11:39:53,031 [INFO] - Section preview: Order #
114-3763243-3669832
View or manage order
Airloons 9.5in Standard Hel.
Qty 1
Order Total:
$64.20...
2025-06-29 11:39:53,031 [INFO] - Found order number: 114-3763243-3669832
2025-06-29 11:39:53,031 [INFO] - Found order total: $64.20
2025-06-29 11:39:53,031 [INFO] - Found product name before Qty: Airloons 9.5in Standard Hel.
2025-06-29 11:39:53,032 [INFO] - Using email date: 2024-12-25
2025-06-29 11:39:53,032 [INFO] - 
[AI] STARTING AI DESCRIPTION GENERATION
2025-06-29 11:39:53,032 [INFO] - [AI] Bedrock client status: Available
2025-06-29 11:39:53,032 [INFO] - [AI] Input vendor: Amazon.com
2025-06-29 11:39:53,033 [INFO] - [AI] Input amount: $64.2
2025-06-29 11:39:53,033 [INFO] - [AI] Input text length: 104 characters
2025-06-29 11:39:53,033 [INFO] - 
[AI] Preparing Bedrock prompt for description generation ===
2025-06-29 11:39:53,033 [INFO] - [AI] Vendor: Amazon.com, Amount: $64.2
2025-06-29 11:39:53,033 [INFO] - [AI] Text preview (first 200 chars): Amazon.com email receipt
Order: 114-3763243-3669832
Products: Airloons 9.5in Standard Hel.
Total: $64.20...
2025-06-29 11:39:53,034 [INFO] - [AI] Candidate models to try (ordered): ['us.anthropic.claude-sonnet-4-20250514-v1:0', 'anthropic.claude-sonnet-4-20250514-v1:0', 'us.anthropic.claude-3-7-sonnet-20250219-v1:0', 'arn:aws:bedrock:us-east-1::inference-profile/us.amazon.nova-premier-v1:0', 'amazon.nova-premier-v1:0', 'amazon.nova-micro-v1:0', 'anthropic.claude-3-haiku-20240307-v1:0']
2025-06-29 11:39:53,034 [INFO] - [AI] Attempting Bedrock call with model: us.anthropic.claude-sonnet-4-20250514-v1:0
2025-06-29 11:39:54,569 [INFO] - [AI] Received response from Bedrock (model us.anthropic.claude-sonnet-4-20250514-v1:0)
2025-06-29 11:39:54,570 [INFO] - [AI] AI Generated description: 'Office Expenses - Live Performance Materials - Airloons 9.5in Standard Helium Balloons - Order #114-3763243-3669832' (len=115)
2025-06-29 11:39:54,571 [INFO] - [AI] Cleaned description: 'Office Expenses - Live Performance Materials - Airloons 9.5in Standard Helium Balloons - Order #114-3763243-3669832'
2025-06-29 11:39:54,571 [INFO] - Added Amazon order: Office Expenses - Live Performance Materials - Airloons 9.5in Standard Helium Balloons - Order #114-3763243-3669832 - $64.20
2025-06-29 11:39:54,571 [INFO] - Parser completed!
2025-06-29 11:39:54,572 [INFO] - Extracted 2 expenses
2025-06-29 11:39:54,572 [INFO] -    Expense 1: Office Expenses - Live Performance Materials - LED Light Up Balloons for Audiovisual Shows - Order 114-6552244-5821058
2025-06-29 11:39:54,572 [INFO] -    Amount: $44.50
2025-06-29 11:39:54,573 [INFO] -    Vendor: Amazon.com
2025-06-29 11:39:54,573 [INFO] - 
2025-06-29 11:39:54,574 [INFO] -    Expense 2: Office Expenses - Live Performance Materials - Airloons 9.5in Standard Helium Balloons - Order #114-3763243-3669832
2025-06-29 11:39:54,574 [INFO] -    Amount: $64.20
2025-06-29 11:39:54,575 [INFO] -    Vendor: Amazon.com
2025-06-29 11:39:54,575 [INFO] - 
2025-06-29 11:39:54,575 [INFO] - Returning response to TypeScript layer...
