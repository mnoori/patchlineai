2025-06-28 21:52:31,651 [INFO] - Loading environment variables from: C:\Users\mehdi\code\patchline_v1\.env.local
2025-06-28 21:52:31,667 [INFO] - [SUCCESS] Loaded AWS credentials: ACCESS_KEY_ID=**********
2025-06-28 21:52:31,668 [INFO] - [SUCCESS] Secret key found: **********
2025-06-28 21:52:31,868 [INFO] - Successfully imported Bedrock model config. Primary model: anthropic.claude-sonnet-4-20250514-v1:0
2025-06-28 21:52:32,099 [INFO] - Found credentials in shared credentials file: ~/.aws/credentials
2025-06-28 21:52:32,128 [INFO] - Starting expense processor server on port 8000 with Waitress...
2025-06-28 21:52:32,133 [INFO] - Serving on http://127.0.0.1:8000
2025-06-28 21:52:51,186 [INFO] - 
========================================
2025-06-28 21:52:51,188 [INFO] - EXPENSE PROCESSOR SERVER - NEW REQUEST
2025-06-28 21:52:51,189 [INFO] - ========================================
2025-06-28 21:52:51,189 [INFO] - Request Details:
2025-06-28 21:52:51,189 [INFO] -    User ID: default-user
2025-06-28 21:52:51,189 [INFO] -    Document ID: test
2025-06-28 21:52:51,189 [INFO] -    Bank Type: gmail-receipts
2025-06-28 21:52:51,189 [INFO] -    Textract Blocks: 0
2025-06-28 21:52:51,190 [INFO] -    Text Length: 146
2025-06-28 21:52:51,191 [INFO] - GMAIL RECEIPTS DETECTED - This should trigger AI description generation
2025-06-28 21:52:51,191 [INFO] - Starting expense parsing...
2025-06-28 21:52:51,192 [INFO] - Calling parser.parse_textract_output()...
2025-06-28 21:52:51,193 [INFO] - 
========================================
2025-06-28 21:52:51,194 [INFO] - GMAIL RECEIPT PARSER - ENTRY POINT
2025-06-28 21:52:51,195 [INFO] - ========================================
2025-06-28 21:52:51,196 [INFO] - Document ID: test
2025-06-28 21:52:51,197 [INFO] - User ID: default-user
2025-06-28 21:52:51,198 [INFO] - Gmail receipt - Processing 6 lines
2025-06-28 21:52:51,198 [INFO] - Total text content length: 146 characters
2025-06-28 21:52:51,198 [INFO] - 
=== First 20 lines of Gmail receipt ===
2025-06-28 21:52:51,199 [INFO] - 0: Meta for Business
2025-06-28 21:52:51,199 [INFO] - 1: Account ID: 434492877229135
2025-06-28 21:52:51,199 [INFO] - 2: Campaign: Holiday Music Launch 2024
2025-06-28 21:52:51,200 [INFO] - 3: Ad Set: DJ Equipment Targeting
2025-06-28 21:52:51,200 [INFO] - 4: Objective: Traffic
2025-06-28 21:52:51,201 [INFO] - 5: Amount: $10.05
2025-06-28 21:52:51,201 [INFO] - === End sample ===

2025-06-28 21:52:51,201 [INFO] - Detected receipt type: generic
2025-06-28 21:52:51,204 [INFO] - 
[AI_CALL] ABOUT TO CALL AI DESCRIPTION GENERATION
2025-06-28 21:52:51,204 [INFO] - ====================================================
2025-06-28 21:52:51,204 [INFO] - [AI_CALL] Text length: 146 characters
2025-06-28 21:52:51,205 [INFO] - [AI_CALL] Vendor detected: None
2025-06-28 21:52:51,205 [INFO] - [AI_CALL] Amount detected: 10.05
2025-06-28 21:52:51,206 [INFO] - [AI_CALL] Is Meta receipt: True
2025-06-28 21:52:51,207 [INFO] - ====================================================
2025-06-28 21:52:51,208 [INFO] - [AI_CALL] Calling generate_receipt_description() NOW...
2025-06-28 21:52:51,208 [INFO] - 
[AI] STARTING AI DESCRIPTION GENERATION
2025-06-28 21:52:51,208 [INFO] - [AI] Bedrock client status: Available
2025-06-28 21:52:51,210 [INFO] - [AI] Input vendor: None
2025-06-28 21:52:51,210 [INFO] - [AI] Input amount: $10.05
2025-06-28 21:52:51,210 [INFO] - [AI] Input text length: 146 characters
2025-06-28 21:52:51,211 [INFO] - 
[AI] Preparing Bedrock prompt for description generation ===
2025-06-28 21:52:51,211 [INFO] - [AI] Vendor: None, Amount: $10.05
2025-06-28 21:52:51,211 [INFO] - [AI] Text preview (first 200 chars): Meta for Business
Account ID: 434492877229135
Campaign: Holiday Music Launch 2024
Ad Set: DJ Equipment Targeting
Objective: Traffic
Amount: $10.05...
2025-06-28 21:52:51,211 [INFO] - [AI] Candidate models to try (ordered): ['anthropic.claude-sonnet-4-20250514-v1:0', 'us.anthropic.claude-sonnet-4-20250514-v1:0', 'us.anthropic.claude-3-7-sonnet-20250219-v1:0', 'arn:aws:bedrock:us-east-1::inference-profile/us.amazon.nova-premier-v1:0', 'amazon.nova-premier-v1:0', 'amazon.nova-micro-v1:0', 'anthropic.claude-3-haiku-20240307-v1:0']
2025-06-28 21:52:51,212 [INFO] - [AI] Attempting Bedrock call with model: anthropic.claude-sonnet-4-20250514-v1:0
2025-06-28 21:52:51,411 [ERROR] - [AI] Error invoking model anthropic.claude-sonnet-4-20250514-v1:0: An error occurred (ValidationException) when calling the InvokeModel operation: Invocation of model ID anthropic.claude-sonnet-4-20250514-v1:0 with on-demand throughput isnâ€™t supported. Retry your request with the ID or ARN of an inference profile that contains this model.
2025-06-28 21:52:51,411 [INFO] - [AI] Attempting Bedrock call with model: us.anthropic.claude-sonnet-4-20250514-v1:0
2025-06-28 21:52:52,886 [INFO] - [AI] Received response from Bedrock (model us.anthropic.claude-sonnet-4-20250514-v1:0)
2025-06-28 21:52:52,887 [INFO] - [AI] AI Generated description: 'Advertising - Meta Ads - Holiday Music Launch 2024 Campaign DJ Equipment Targeting - Account #229135' (len=100)
2025-06-28 21:52:52,888 [INFO] - [AI] Cleaned description: 'Advertising - Meta Ads - Holiday Music Launch 2024 Campaign DJ Equipment Targeting - Account #229135'
2025-06-28 21:52:52,888 [INFO] - [AI_CALL] RETURNED FROM AI: 'Advertising - Meta Ads - Holiday Music Launch 2024 Campaign DJ Equipment Targeting - Account #229135'
2025-06-28 21:52:52,888 [INFO] - Parser completed!
2025-06-28 21:52:52,888 [INFO] - Extracted 0 expenses
2025-06-28 21:52:52,888 [INFO] - Returning response to TypeScript layer...
2025-06-28 21:53:25,818 [INFO] - 
========================================
2025-06-28 21:53:25,818 [INFO] - EXPENSE PROCESSOR SERVER - NEW REQUEST
2025-06-28 21:53:25,819 [INFO] - ========================================
2025-06-28 21:53:25,819 [INFO] - Request Details:
2025-06-28 21:53:25,819 [INFO] -    User ID: default-user
2025-06-28 21:53:25,819 [INFO] -    Document ID: test2
2025-06-28 21:53:25,819 [INFO] -    Bank Type: gmail-receipts
2025-06-28 21:53:25,820 [INFO] -    Textract Blocks: 0
2025-06-28 21:53:25,820 [INFO] -    Text Length: 130
2025-06-28 21:53:25,820 [INFO] - GMAIL RECEIPTS DETECTED - This should trigger AI description generation
2025-06-28 21:53:25,820 [INFO] - Starting expense parsing...
2025-06-28 21:53:25,820 [INFO] - Calling parser.parse_textract_output()...
2025-06-28 21:53:25,820 [INFO] - 
========================================
2025-06-28 21:53:25,820 [INFO] - GMAIL RECEIPT PARSER - ENTRY POINT
2025-06-28 21:53:25,820 [INFO] - ========================================
2025-06-28 21:53:25,820 [INFO] - Document ID: test2
2025-06-28 21:53:25,821 [INFO] - User ID: default-user
2025-06-28 21:53:25,821 [INFO] - Gmail receipt - Processing 6 lines
2025-06-28 21:53:25,821 [INFO] - Total text content length: 130 characters
2025-06-28 21:53:25,821 [INFO] - 
=== First 20 lines of Gmail receipt ===
2025-06-28 21:53:25,821 [INFO] - 0: Midjourney Inc.
2025-06-28 21:53:25,821 [INFO] - 1: Receipt
2025-06-28 21:53:25,821 [INFO] - 2: Plan: Pro Monthly
2025-06-28 21:53:25,822 [INFO] - 3: Amount: $60.00
2025-06-28 21:53:25,822 [INFO] - 4: Billing Period: January 2024
2025-06-28 21:53:25,822 [INFO] - 5: For AI image generation and creative content
2025-06-28 21:53:25,822 [INFO] - === End sample ===

2025-06-28 21:53:25,822 [INFO] - Detected receipt type: midjourney
2025-06-28 21:53:25,823 [INFO] - 
[AI] STARTING AI DESCRIPTION GENERATION
2025-06-28 21:53:25,824 [INFO] - [AI] Bedrock client status: Available
2025-06-28 21:53:25,824 [INFO] - [AI] Input vendor: Midjourney Inc
2025-06-28 21:53:25,824 [INFO] - [AI] Input amount: $60.0
2025-06-28 21:53:25,824 [INFO] - [AI] Input text length: 130 characters
2025-06-28 21:53:25,824 [INFO] - 
[AI] Preparing Bedrock prompt for description generation ===
2025-06-28 21:53:25,824 [INFO] - [AI] Vendor: Midjourney Inc, Amount: $60.0
2025-06-28 21:53:25,824 [INFO] - [AI] Text preview (first 200 chars): Midjourney Inc.
Receipt
Plan: Pro Monthly
Amount: $60.00
Billing Period: January 2024
For AI image generation and creative content...
2025-06-28 21:53:25,825 [INFO] - [AI] Candidate models to try (ordered): ['us.anthropic.claude-sonnet-4-20250514-v1:0', 'anthropic.claude-sonnet-4-20250514-v1:0', 'us.anthropic.claude-3-7-sonnet-20250219-v1:0', 'arn:aws:bedrock:us-east-1::inference-profile/us.amazon.nova-premier-v1:0', 'amazon.nova-premier-v1:0', 'amazon.nova-micro-v1:0', 'anthropic.claude-3-haiku-20240307-v1:0']
2025-06-28 21:53:25,825 [INFO] - [AI] Attempting Bedrock call with model: us.anthropic.claude-sonnet-4-20250514-v1:0
2025-06-28 21:53:27,381 [INFO] - [AI] Received response from Bedrock (model us.anthropic.claude-sonnet-4-20250514-v1:0)
2025-06-28 21:53:27,381 [INFO] - [AI] AI Generated description: 'Office Expenses - Midjourney Pro Monthly Subscription - AI Image Generation for Creative Content Development - January 2024' (len=123)
2025-06-28 21:53:27,382 [INFO] - [AI] Cleaned description: 'Office Expenses - Midjourney Pro Monthly Subscription - AI Image Generation for Creative Content Development - January 2024'
2025-06-28 21:53:27,382 [INFO] - Parser completed!
2025-06-28 21:53:27,382 [INFO] - Extracted 0 expenses
2025-06-28 21:53:27,382 [INFO] - Returning response to TypeScript layer...
2025-06-28 21:54:18,938 [INFO] - 
========================================
2025-06-28 21:54:18,939 [INFO] - EXPENSE PROCESSOR SERVER - NEW REQUEST
2025-06-28 21:54:18,943 [INFO] - ========================================
2025-06-28 21:54:18,951 [INFO] - Request Details:
2025-06-28 21:54:18,953 [INFO] -    User ID: default-user
2025-06-28 21:54:18,953 [INFO] -    Document ID: doc_1751162050995_z4atyb
2025-06-28 21:54:18,954 [INFO] -    Bank Type: gmail-receipts
2025-06-28 21:54:18,954 [INFO] -    Textract Blocks: 862
2025-06-28 21:54:18,955 [INFO] -    Text Length: 3645
2025-06-28 21:54:18,955 [INFO] - GMAIL RECEIPTS DETECTED - This should trigger AI description generation
2025-06-28 21:54:18,955 [INFO] - Starting expense parsing...
2025-06-28 21:54:18,955 [INFO] - Calling parser.parse_textract_output()...
2025-06-28 21:54:18,956 [INFO] - 
========================================
2025-06-28 21:54:18,956 [INFO] - GMAIL RECEIPT PARSER - ENTRY POINT
2025-06-28 21:54:18,957 [INFO] - ========================================
2025-06-28 21:54:18,957 [INFO] - Document ID: doc_1751162050995_z4atyb
2025-06-28 21:54:18,957 [INFO] - User ID: default-user
2025-06-28 21:54:18,957 [INFO] - Gmail receipt - Processing 133 lines
2025-06-28 21:54:18,957 [INFO] - Total text content length: 3644 characters
2025-06-28 21:54:18,958 [INFO] - 
=== First 20 lines of Gmail receipt ===
2025-06-28 21:54:18,958 [INFO] - 0: Gmail
2025-06-28 21:54:18,958 [INFO] - 1: Mehdi <mehdi.noori7@gmail.com>
2025-06-28 21:54:18,958 [INFO] - 2: Your Meta ads receipt (Account ID: 434492877229135)
2025-06-28 21:54:18,959 [INFO] - 3: 3 messages
2025-06-28 21:54:18,959 [INFO] - 4: Meta for Business <advertise-noreply@support.facebook.com>
2025-06-28 21:54:18,959 [INFO] - 5: Thu, Dec 26, 2024 at 9:11 AM
2025-06-28 21:54:18,959 [INFO] - 6: Reply-To: noreply <noreply@facebookmail.com>
2025-06-28 21:54:18,959 [INFO] - 7: To: Mehdi Noori <mehdi.noori7@gmail.com>
2025-06-28 21:54:18,959 [INFO] - 8: 8
2025-06-28 21:54:18,960 [INFO] - 9: Meta
2025-06-28 21:54:18,960 [INFO] - 10: Receipt for
2025-06-28 21:54:18,960 [INFO] - 11: Transaction ID
2025-06-28 21:54:18,960 [INFO] - 12: Mehdi Noori (434492877229135)
2025-06-28 21:54:18,961 [INFO] - 13: 8819232221523382-9015336571912940
2025-06-28 21:54:18,961 [INFO] - 14: Payment summary
2025-06-28 21:54:18,961 [INFO] - 15: Amount billed
2025-06-28 21:54:18,961 [INFO] - 16: Date range
2025-06-28 21:54:18,961 [INFO] - 17: $35.00 USD
2025-06-28 21:54:18,961 [INFO] - 18: Dec 25, 2024, 12:00 AM - Dec 26, 2024,
2025-06-28 21:54:18,961 [INFO] - 19: 6:11 AM
2025-06-28 21:54:18,963 [INFO] - === End sample ===

2025-06-28 21:54:18,965 [INFO] - Detected receipt type: generic
2025-06-28 21:54:18,968 [INFO] - 
[AI_CALL] ABOUT TO CALL AI DESCRIPTION GENERATION
2025-06-28 21:54:18,969 [INFO] - ====================================================
2025-06-28 21:54:18,969 [INFO] - [AI_CALL] Text length: 3644 characters
2025-06-28 21:54:18,969 [INFO] - [AI_CALL] Vendor detected: Meta Platforms Inc., formerly Facebook, Inc.
2025-06-28 21:54:18,970 [INFO] - [AI_CALL] Amount detected: 35.00
2025-06-28 21:54:18,970 [INFO] - [AI_CALL] Is Meta receipt: True
2025-06-28 21:54:18,970 [INFO] - ====================================================
2025-06-28 21:54:18,970 [INFO] - [AI_CALL] Calling generate_receipt_description() NOW...
2025-06-28 21:54:18,972 [INFO] - 
[AI] STARTING AI DESCRIPTION GENERATION
2025-06-28 21:54:18,975 [INFO] - [AI] Bedrock client status: Available
2025-06-28 21:54:18,976 [INFO] - [AI] Input vendor: Meta Platforms Inc., formerly Facebook, Inc.
2025-06-28 21:54:18,976 [INFO] - [AI] Input amount: $35.0
2025-06-28 21:54:18,976 [INFO] - [AI] Input text length: 3644 characters
2025-06-28 21:54:18,976 [INFO] - 
[AI] Preparing Bedrock prompt for description generation ===
2025-06-28 21:54:18,976 [INFO] - [AI] Vendor: Meta Platforms Inc., formerly Facebook, Inc., Amount: $35.0
2025-06-28 21:54:18,976 [INFO] - [AI] Text preview (first 200 chars): Gmail
Mehdi <mehdi.noori7@gmail.com>
Your Meta ads receipt (Account ID: 434492877229135)
3 messages
Meta for Business <advertise-noreply@support.facebook.com>
Thu, Dec 26, 2024 at 9:11 AM
Reply-To: no...
2025-06-28 21:54:18,977 [INFO] - [AI] Candidate models to try (ordered): ['us.anthropic.claude-sonnet-4-20250514-v1:0', 'anthropic.claude-sonnet-4-20250514-v1:0', 'us.anthropic.claude-3-7-sonnet-20250219-v1:0', 'arn:aws:bedrock:us-east-1::inference-profile/us.amazon.nova-premier-v1:0', 'amazon.nova-premier-v1:0', 'amazon.nova-micro-v1:0', 'anthropic.claude-3-haiku-20240307-v1:0']
2025-06-28 21:54:18,977 [INFO] - [AI] Attempting Bedrock call with model: us.anthropic.claude-sonnet-4-20250514-v1:0
2025-06-28 21:54:21,054 [INFO] - [AI] Received response from Bedrock (model us.anthropic.claude-sonnet-4-20250514-v1:0)
2025-06-28 21:54:21,056 [INFO] - [AI] AI Generated description: 'Advertising - Meta Ads - Instagram YX Day 18 Music Track Promotion Campaign - Account 229135 - Dec 25-26 Billing Period' (len=119)
2025-06-28 21:54:21,056 [INFO] - [AI] Cleaned description: 'Advertising - Meta Ads - Instagram YX Day 18 Music Track Promotion Campaign - Account 229135 - Dec 25-26 Billing Period'
2025-06-28 21:54:21,056 [INFO] - [AI_CALL] RETURNED FROM AI: 'Advertising - Meta Ads - Instagram YX Day 18 Music Track Promotion Campaign - Account 229135 - Dec 25-26 Billing Period'
2025-06-28 21:54:21,059 [INFO] - Added generic expense: Advertising - Meta Ads - Instagram YX Day 18 Music Track Promotion Campaign - Account 229135 - Dec 25-26 Billing Period - $35.00 on 2024-12-26
2025-06-28 21:54:21,059 [INFO] - Parser completed!
2025-06-28 21:54:21,059 [INFO] - Extracted 1 expenses
2025-06-28 21:54:21,059 [INFO] -    Expense 1: Advertising - Meta Ads - Instagram YX Day 18 Music Track Promotion Campaign - Account 229135 - Dec 25-26 Billing Period
2025-06-28 21:54:21,060 [INFO] -    Amount: $35.00
2025-06-28 21:54:21,060 [INFO] -    Vendor: Meta Platforms Inc., formerly Facebook, Inc.
2025-06-28 21:54:21,060 [INFO] - 
2025-06-28 21:54:21,069 [INFO] - Returning response to TypeScript layer...
2025-06-28 21:55:32,521 [INFO] - 
========================================
2025-06-28 21:55:32,523 [INFO] - EXPENSE PROCESSOR SERVER - NEW REQUEST
2025-06-28 21:55:32,523 [INFO] - ========================================
2025-06-28 21:55:32,525 [INFO] - Request Details:
2025-06-28 21:55:32,525 [INFO] -    User ID: default-user
2025-06-28 21:55:32,525 [INFO] -    Document ID: doc_1751162126399_13tdsk
2025-06-28 21:55:32,525 [INFO] -    Bank Type: gmail-receipts
2025-06-28 21:55:32,527 [INFO] -    Textract Blocks: 286
2025-06-28 21:55:32,528 [INFO] -    Text Length: 1236
2025-06-28 21:55:32,533 [INFO] - GMAIL RECEIPTS DETECTED - This should trigger AI description generation
2025-06-28 21:55:32,540 [INFO] - Starting expense parsing...
2025-06-28 21:55:32,543 [INFO] - Calling parser.parse_textract_output()...
2025-06-28 21:55:32,555 [INFO] - 
========================================
2025-06-28 21:55:32,557 [INFO] - GMAIL RECEIPT PARSER - ENTRY POINT
2025-06-28 21:55:32,559 [INFO] - ========================================
2025-06-28 21:55:32,564 [INFO] - Document ID: doc_1751162126399_13tdsk
2025-06-28 21:55:32,565 [INFO] - User ID: default-user
2025-06-28 21:55:32,681 [INFO] - Gmail receipt - Processing 46 lines
2025-06-28 21:55:32,692 [INFO] - Total text content length: 1235 characters
2025-06-28 21:55:32,693 [INFO] - 
=== First 20 lines of Gmail receipt ===
2025-06-28 21:55:32,694 [INFO] - 0: Gmail
2025-06-28 21:55:32,694 [INFO] - 1: Mehdi <mehdi.noori7@gmail.com>
2025-06-28 21:55:32,694 [INFO] - 2: Your Meta ads receipt (Account ID: 434492877229135)
2025-06-28 21:55:32,697 [INFO] - 3: 1 message
2025-06-28 21:55:32,698 [INFO] - 4: Meta for Business <advertise-noreply@support.facebook.com>
2025-06-28 21:55:32,698 [INFO] - 5: Tue, Dec 10, 2024 at 9:48 AM
2025-06-28 21:55:32,698 [INFO] - 6: Reply-To: noreply <noreply@facebookmail.com>
2025-06-28 21:55:32,698 [INFO] - 7: To: Mehdi Noori <mehdi.noori7@gmail.com>
2025-06-28 21:55:32,698 [INFO] - 8: 8
2025-06-28 21:55:32,698 [INFO] - 9: Meta
2025-06-28 21:55:32,698 [INFO] - 10: Receipt for
2025-06-28 21:55:32,698 [INFO] - 11: Transaction ID
2025-06-28 21:55:32,700 [INFO] - 12: Mehdi Noori (434492877229135)
2025-06-28 21:55:32,700 [INFO] - 13: 8726057747507497-8726057757507496
2025-06-28 21:55:32,700 [INFO] - 14: Payment summary
2025-06-28 21:55:32,700 [INFO] - 15: Amount billed
2025-06-28 21:55:32,726 [INFO] - 16: Date range
2025-06-28 21:55:32,732 [INFO] - 17: $16.66 USD
2025-06-28 21:55:32,733 [INFO] - 18: Dec 9, 2024, 12:00 AM - Dec 9, 2024,
2025-06-28 21:55:32,736 [INFO] - 19: 11:59 PM
2025-06-28 21:55:32,737 [INFO] - === End sample ===

2025-06-28 21:55:32,737 [INFO] - Detected receipt type: generic
2025-06-28 21:55:32,743 [INFO] - 
[AI_CALL] ABOUT TO CALL AI DESCRIPTION GENERATION
2025-06-28 21:55:32,743 [INFO] - ====================================================
2025-06-28 21:55:32,744 [INFO] - [AI_CALL] Text length: 1235 characters
2025-06-28 21:55:32,744 [INFO] - [AI_CALL] Vendor detected: Meta Platforms Inc., formerly Facebook, Inc.
2025-06-28 21:55:32,748 [INFO] - [AI_CALL] Amount detected: 16.66
2025-06-28 21:55:32,865 [INFO] - [AI_CALL] Is Meta receipt: True
2025-06-28 21:55:32,872 [INFO] - ====================================================
2025-06-28 21:55:32,880 [INFO] - [AI_CALL] Calling generate_receipt_description() NOW...
2025-06-28 21:55:32,880 [INFO] - 
[AI] STARTING AI DESCRIPTION GENERATION
2025-06-28 21:55:32,881 [INFO] - [AI] Bedrock client status: Available
2025-06-28 21:55:32,881 [INFO] - [AI] Input vendor: Meta Platforms Inc., formerly Facebook, Inc.
2025-06-28 21:55:32,882 [INFO] - [AI] Input amount: $16.66
2025-06-28 21:55:32,882 [INFO] - [AI] Input text length: 1235 characters
2025-06-28 21:55:32,882 [INFO] - 
[AI] Preparing Bedrock prompt for description generation ===
2025-06-28 21:55:32,882 [INFO] - [AI] Vendor: Meta Platforms Inc., formerly Facebook, Inc., Amount: $16.66
2025-06-28 21:55:32,882 [INFO] - [AI] Text preview (first 200 chars): Gmail
Mehdi <mehdi.noori7@gmail.com>
Your Meta ads receipt (Account ID: 434492877229135)
1 message
Meta for Business <advertise-noreply@support.facebook.com>
Tue, Dec 10, 2024 at 9:48 AM
Reply-To: nor...
2025-06-28 21:55:32,882 [INFO] - [AI] Candidate models to try (ordered): ['us.anthropic.claude-sonnet-4-20250514-v1:0', 'anthropic.claude-sonnet-4-20250514-v1:0', 'us.anthropic.claude-3-7-sonnet-20250219-v1:0', 'arn:aws:bedrock:us-east-1::inference-profile/us.amazon.nova-premier-v1:0', 'amazon.nova-premier-v1:0', 'amazon.nova-micro-v1:0', 'anthropic.claude-3-haiku-20240307-v1:0']
2025-06-28 21:55:32,883 [INFO] - [AI] Attempting Bedrock call with model: us.anthropic.claude-sonnet-4-20250514-v1:0
2025-06-28 21:55:34,850 [INFO] - [AI] Received response from Bedrock (model us.anthropic.claude-sonnet-4-20250514-v1:0)
2025-06-28 21:55:34,851 [INFO] - [AI] AI Generated description: 'Advertising - Meta Ads - Instagram Post YX Reliable Bandmates Campaign - Account 229135 - Dec 9 Billing Period' (len=110)
2025-06-28 21:55:34,851 [INFO] - [AI] Cleaned description: 'Advertising - Meta Ads - Instagram Post YX Reliable Bandmates Campaign - Account 229135 - Dec 9 Billing Period'
2025-06-28 21:55:34,851 [INFO] - [AI_CALL] RETURNED FROM AI: 'Advertising - Meta Ads - Instagram Post YX Reliable Bandmates Campaign - Account 229135 - Dec 9 Billing Period'
2025-06-28 21:55:34,852 [INFO] - Added generic expense: Advertising - Meta Ads - Instagram Post YX Reliable Bandmates Campaign - Account 229135 - Dec 9 Billing Period - $16.66 on 2024-12-10
2025-06-28 21:55:34,852 [INFO] - Parser completed!
2025-06-28 21:55:34,852 [INFO] - Extracted 1 expenses
2025-06-28 21:55:34,852 [INFO] -    Expense 1: Advertising - Meta Ads - Instagram Post YX Reliable Bandmates Campaign - Account 229135 - Dec 9 Billing Period
2025-06-28 21:55:34,853 [INFO] -    Amount: $16.66
2025-06-28 21:55:34,853 [INFO] -    Vendor: Meta Platforms Inc., formerly Facebook, Inc.
2025-06-28 21:55:34,854 [INFO] - 
2025-06-28 21:55:34,854 [INFO] - Returning response to TypeScript layer...
2025-06-28 21:55:41,645 [INFO] - 
========================================
2025-06-28 21:55:41,646 [INFO] - EXPENSE PROCESSOR SERVER - NEW REQUEST
2025-06-28 21:55:41,647 [INFO] - ========================================
2025-06-28 21:55:41,651 [INFO] - Request Details:
2025-06-28 21:55:41,651 [INFO] -    User ID: default-user
2025-06-28 21:55:41,653 [INFO] -    Document ID: doc_1751162135343_c9uvn3
2025-06-28 21:55:41,654 [INFO] -    Bank Type: gmail-receipts
2025-06-28 21:55:41,654 [INFO] -    Textract Blocks: 289
2025-06-28 21:55:41,654 [INFO] -    Text Length: 1239
2025-06-28 21:55:41,655 [INFO] - GMAIL RECEIPTS DETECTED - This should trigger AI description generation
2025-06-28 21:55:41,655 [INFO] - Starting expense parsing...
2025-06-28 21:55:41,655 [INFO] - Calling parser.parse_textract_output()...
2025-06-28 21:55:41,655 [INFO] - 
========================================
2025-06-28 21:55:41,656 [INFO] - GMAIL RECEIPT PARSER - ENTRY POINT
2025-06-28 21:55:41,656 [INFO] - ========================================
2025-06-28 21:55:41,656 [INFO] - Document ID: doc_1751162135343_c9uvn3
2025-06-28 21:55:41,657 [INFO] - User ID: default-user
2025-06-28 21:55:41,657 [INFO] - Gmail receipt - Processing 46 lines
2025-06-28 21:55:41,657 [INFO] - Total text content length: 1238 characters
2025-06-28 21:55:41,657 [INFO] - 
=== First 20 lines of Gmail receipt ===
2025-06-28 21:55:41,657 [INFO] - 0: Gmail
2025-06-28 21:55:41,658 [INFO] - 1: Mehdi <mehdi.noori7@gmail.com>
2025-06-28 21:55:41,658 [INFO] - 2: Your Meta ads receipt (Account ID: 434492877229135)
2025-06-28 21:55:41,658 [INFO] - 3: 1 message
2025-06-28 21:55:41,658 [INFO] - 4: Meta for Business <advertise-noreply@support.facebook.com>
2025-06-28 21:55:41,658 [INFO] - 5: Sun, Dec 8, 2024 at 10:02 AM
2025-06-28 21:55:41,658 [INFO] - 6: Reply-To: noreply <noreply@facebookmail.com>
2025-06-28 21:55:41,659 [INFO] - 7: To: Mehdi Noori <mehdi.noori7@gmail.com>
2025-06-28 21:55:41,659 [INFO] - 8: 8
2025-06-28 21:55:41,659 [INFO] - 9: Meta
2025-06-28 21:55:41,659 [INFO] - 10: Receipt for
2025-06-28 21:55:41,660 [INFO] - 11: Transaction ID
2025-06-28 21:55:41,660 [INFO] - 12: Mehdi Noori (434492877229135)
2025-06-28 21:55:41,660 [INFO] - 13: 8783705691742701-8749508355162437
2025-06-28 21:55:41,660 [INFO] - 14: Payment summary
2025-06-28 21:55:41,660 [INFO] - 15: Amount billed
2025-06-28 21:55:41,661 [INFO] - 16: Date range
2025-06-28 21:55:41,661 [INFO] - 17: $3.78 USD
2025-06-28 21:55:41,661 [INFO] - 18: Dec 7, 2024, 12:00 AM - Dec 7, 2024,
2025-06-28 21:55:41,661 [INFO] - 19: 11:59 PM
2025-06-28 21:55:41,661 [INFO] - === End sample ===

2025-06-28 21:55:41,662 [INFO] - Detected receipt type: generic
2025-06-28 21:55:41,663 [INFO] - 
[AI_CALL] ABOUT TO CALL AI DESCRIPTION GENERATION
2025-06-28 21:55:41,663 [INFO] - ====================================================
2025-06-28 21:55:41,663 [INFO] - [AI_CALL] Text length: 1238 characters
2025-06-28 21:55:41,664 [INFO] - [AI_CALL] Vendor detected: Meta Platforms Inc., formerly Facebook, Inc.
2025-06-28 21:55:41,664 [INFO] - [AI_CALL] Amount detected: 3.78
2025-06-28 21:55:41,664 [INFO] - [AI_CALL] Is Meta receipt: True
2025-06-28 21:55:41,664 [INFO] - ====================================================
2025-06-28 21:55:41,664 [INFO] - [AI_CALL] Calling generate_receipt_description() NOW...
2025-06-28 21:55:41,664 [INFO] - 
[AI] STARTING AI DESCRIPTION GENERATION
2025-06-28 21:55:41,665 [INFO] - [AI] Bedrock client status: Available
2025-06-28 21:55:41,665 [INFO] - [AI] Input vendor: Meta Platforms Inc., formerly Facebook, Inc.
2025-06-28 21:55:41,665 [INFO] - [AI] Input amount: $3.78
2025-06-28 21:55:41,665 [INFO] - [AI] Input text length: 1238 characters
2025-06-28 21:55:41,665 [INFO] - 
[AI] Preparing Bedrock prompt for description generation ===
2025-06-28 21:55:41,665 [INFO] - [AI] Vendor: Meta Platforms Inc., formerly Facebook, Inc., Amount: $3.78
2025-06-28 21:55:41,665 [INFO] - [AI] Text preview (first 200 chars): Gmail
Mehdi <mehdi.noori7@gmail.com>
Your Meta ads receipt (Account ID: 434492877229135)
1 message
Meta for Business <advertise-noreply@support.facebook.com>
Sun, Dec 8, 2024 at 10:02 AM
Reply-To: nor...
2025-06-28 21:55:41,665 [INFO] - [AI] Candidate models to try (ordered): ['us.anthropic.claude-sonnet-4-20250514-v1:0', 'anthropic.claude-sonnet-4-20250514-v1:0', 'us.anthropic.claude-3-7-sonnet-20250219-v1:0', 'arn:aws:bedrock:us-east-1::inference-profile/us.amazon.nova-premier-v1:0', 'amazon.nova-premier-v1:0', 'amazon.nova-micro-v1:0', 'anthropic.claude-3-haiku-20240307-v1:0']
2025-06-28 21:55:41,665 [INFO] - [AI] Attempting Bedrock call with model: us.anthropic.claude-sonnet-4-20250514-v1:0
2025-06-28 21:55:43,600 [INFO] - [AI] Received response from Bedrock (model us.anthropic.claude-sonnet-4-20250514-v1:0)
2025-06-28 21:55:43,600 [INFO] - [AI] AI Generated description: 'Advertising - Meta Ads - Instagram Robot Eye Technology Campaign (Account 229135) - Dec 7 Billing Period' (len=104)
2025-06-28 21:55:43,600 [INFO] - [AI] Cleaned description: 'Advertising - Meta Ads - Instagram Robot Eye Technology Campaign (Account 229135) - Dec 7 Billing Period'
2025-06-28 21:55:43,600 [INFO] - [AI_CALL] RETURNED FROM AI: 'Advertising - Meta Ads - Instagram Robot Eye Technology Campaign (Account 229135) - Dec 7 Billing Period'
2025-06-28 21:55:43,601 [INFO] - Added generic expense: Advertising - Meta Ads - Instagram Robot Eye Technology Campaign (Account 229135) - Dec 7 Billing Period - $3.78 on 2024-12-08
2025-06-28 21:55:43,601 [INFO] - Parser completed!
2025-06-28 21:55:43,601 [INFO] - Extracted 1 expenses
2025-06-28 21:55:43,601 [INFO] -    Expense 1: Advertising - Meta Ads - Instagram Robot Eye Technology Campaign (Account 229135) - Dec 7 Billing Period
2025-06-28 21:55:43,601 [INFO] -    Amount: $3.78
2025-06-28 21:55:43,601 [INFO] -    Vendor: Meta Platforms Inc., formerly Facebook, Inc.
2025-06-28 21:55:43,601 [INFO] - 
2025-06-28 21:55:43,601 [INFO] - Returning response to TypeScript layer...
2025-06-28 21:55:55,181 [INFO] - 
========================================
2025-06-28 21:55:55,182 [INFO] - EXPENSE PROCESSOR SERVER - NEW REQUEST
2025-06-28 21:55:55,182 [INFO] - ========================================
2025-06-28 21:55:55,185 [INFO] - Request Details:
2025-06-28 21:55:55,233 [INFO] -    User ID: default-user
2025-06-28 21:55:55,279 [INFO] -    Document ID: doc_1751162145275_jfxoa
2025-06-28 21:55:55,415 [INFO] -    Bank Type: gmail-receipts
2025-06-28 21:55:55,497 [INFO] -    Textract Blocks: 289
2025-06-28 21:55:55,499 [INFO] -    Text Length: 1242
2025-06-28 21:55:55,503 [INFO] - GMAIL RECEIPTS DETECTED - This should trigger AI description generation
2025-06-28 21:55:55,511 [INFO] - Starting expense parsing...
2025-06-28 21:55:55,512 [INFO] - Calling parser.parse_textract_output()...
2025-06-28 21:55:55,512 [INFO] - 
========================================
2025-06-28 21:55:55,512 [INFO] - GMAIL RECEIPT PARSER - ENTRY POINT
2025-06-28 21:55:55,513 [INFO] - ========================================
2025-06-28 21:55:55,514 [INFO] - Document ID: doc_1751162145275_jfxoa
2025-06-28 21:55:55,514 [INFO] - User ID: default-user
2025-06-28 21:55:55,515 [INFO] - Gmail receipt - Processing 46 lines
2025-06-28 21:55:55,515 [INFO] - Total text content length: 1241 characters
2025-06-28 21:55:55,516 [INFO] - 
=== First 20 lines of Gmail receipt ===
2025-06-28 21:55:55,516 [INFO] - 0: Gmail
2025-06-28 21:55:55,520 [INFO] - 1: Mehdi <mehdi.noori7@gmail.com>
2025-06-28 21:55:55,521 [INFO] - 2: Your Meta ads receipt (Account ID: 434492877229135)
2025-06-28 21:55:55,522 [INFO] - 3: 1 message
2025-06-28 21:55:55,523 [INFO] - 4: Meta for Business <advertise-noreply@support.facebook.com>
2025-06-28 21:55:55,523 [INFO] - 5: Sat, Dec 7, 2024 at 10:06 AM
2025-06-28 21:55:55,524 [INFO] - 6: Reply-To: noreply <noreply@facebookmail.com>
2025-06-28 21:55:55,524 [INFO] - 7: To: Mehdi Noori <mehdi.noori7@gmail.com>
2025-06-28 21:55:55,524 [INFO] - 8: 8
2025-06-28 21:55:55,525 [INFO] - 9: Meta
2025-06-28 21:55:55,525 [INFO] - 10: Receipt for
2025-06-28 21:55:55,526 [INFO] - 11: Transaction ID
2025-06-28 21:55:55,526 [INFO] - 12: Mehdi Noori (434492877229135)
2025-06-28 21:55:55,528 [INFO] - 13: 8778109038969033-8831357780310824
2025-06-28 21:55:55,529 [INFO] - 14: Payment summary
2025-06-28 21:55:55,530 [INFO] - 15: Amount billed
2025-06-28 21:55:55,531 [INFO] - 16: Date range
2025-06-28 21:55:55,531 [INFO] - 17: $11.22 USD
2025-06-28 21:55:55,531 [INFO] - 18: Dec 6, 2024, 12:00 AM - Dec 6, 2024,
2025-06-28 21:55:55,532 [INFO] - 19: 11:59 PM
2025-06-28 21:55:55,532 [INFO] - === End sample ===

2025-06-28 21:55:55,532 [INFO] - Detected receipt type: generic
2025-06-28 21:55:55,533 [INFO] - 
[AI_CALL] ABOUT TO CALL AI DESCRIPTION GENERATION
2025-06-28 21:55:55,533 [INFO] - ====================================================
2025-06-28 21:55:55,533 [INFO] - [AI_CALL] Text length: 1241 characters
2025-06-28 21:55:55,533 [INFO] - [AI_CALL] Vendor detected: Meta Platforms Inc., formerly Facebook, Inc.
2025-06-28 21:55:55,537 [INFO] - [AI_CALL] Amount detected: 11.22
2025-06-28 21:55:55,541 [INFO] - [AI_CALL] Is Meta receipt: True
2025-06-28 21:55:55,543 [INFO] - ====================================================
2025-06-28 21:55:55,544 [INFO] - [AI_CALL] Calling generate_receipt_description() NOW...
2025-06-28 21:55:55,544 [INFO] - 
[AI] STARTING AI DESCRIPTION GENERATION
2025-06-28 21:55:55,544 [INFO] - [AI] Bedrock client status: Available
2025-06-28 21:55:55,544 [INFO] - [AI] Input vendor: Meta Platforms Inc., formerly Facebook, Inc.
2025-06-28 21:55:55,545 [INFO] - [AI] Input amount: $11.22
2025-06-28 21:55:55,547 [INFO] - [AI] Input text length: 1241 characters
2025-06-28 21:55:55,547 [INFO] - 
[AI] Preparing Bedrock prompt for description generation ===
2025-06-28 21:55:55,547 [INFO] - [AI] Vendor: Meta Platforms Inc., formerly Facebook, Inc., Amount: $11.22
2025-06-28 21:55:55,547 [INFO] - [AI] Text preview (first 200 chars): Gmail
Mehdi <mehdi.noori7@gmail.com>
Your Meta ads receipt (Account ID: 434492877229135)
1 message
Meta for Business <advertise-noreply@support.facebook.com>
Sat, Dec 7, 2024 at 10:06 AM
Reply-To: nor...
2025-06-28 21:55:55,548 [INFO] - [AI] Candidate models to try (ordered): ['us.anthropic.claude-sonnet-4-20250514-v1:0', 'anthropic.claude-sonnet-4-20250514-v1:0', 'us.anthropic.claude-3-7-sonnet-20250219-v1:0', 'arn:aws:bedrock:us-east-1::inference-profile/us.amazon.nova-premier-v1:0', 'amazon.nova-premier-v1:0', 'amazon.nova-micro-v1:0', 'anthropic.claude-3-haiku-20240307-v1:0']
2025-06-28 21:55:55,548 [INFO] - [AI] Attempting Bedrock call with model: us.anthropic.claude-sonnet-4-20250514-v1:0
2025-06-28 21:56:00,893 [ERROR] - [AI] Error invoking model us.anthropic.claude-sonnet-4-20250514-v1:0: An error occurred (ThrottlingException) when calling the InvokeModel operation (reached max retries: 4): Too many requests, please wait before trying again.
2025-06-28 21:56:00,893 [INFO] - [AI] Attempting Bedrock call with model: anthropic.claude-sonnet-4-20250514-v1:0
2025-06-28 21:56:00,936 [ERROR] - [AI] Error invoking model anthropic.claude-sonnet-4-20250514-v1:0: An error occurred (ValidationException) when calling the InvokeModel operation: Invocation of model ID anthropic.claude-sonnet-4-20250514-v1:0 with on-demand throughput isnâ€™t supported. Retry your request with the ID or ARN of an inference profile that contains this model.
2025-06-28 21:56:00,938 [INFO] - [AI] Attempting Bedrock call with model: us.anthropic.claude-3-7-sonnet-20250219-v1:0
2025-06-28 21:56:02,490 [INFO] - [AI] Received response from Bedrock (model us.anthropic.claude-3-7-sonnet-20250219-v1:0)
2025-06-28 21:56:02,669 [INFO] - [AI] AI Generated description: 'Advertising - Meta Platforms Inc. - Instagram Post Campaign "Robot Eye is here! WOW technology" - 547 Impressions - Acct #877229135 - Dec 6, 2024' (len=145)
2025-06-28 21:56:02,670 [INFO] - [AI] Cleaned description: 'Advertising - Meta Platforms Inc. - Instagram Post Campaign "Robot Eye is here! WOW technology" - 547 Impressions - Acct #877229135 - Dec 6, 2024'
2025-06-28 21:56:02,670 [INFO] - [AI_CALL] RETURNED FROM AI: 'Advertising - Meta Platforms Inc. - Instagram Post Campaign "Robot Eye is here! WOW technology" - 547 Impressions - A...'
2025-06-28 21:56:02,670 [INFO] - Added generic expense: Advertising - Meta Platforms Inc. - Instagram Post Campaign "Robot Eye is here! WOW technology" - 547 Impressions - A... - $11.22 on 2024-12-07
2025-06-28 21:56:02,670 [INFO] - Parser completed!
2025-06-28 21:56:02,671 [INFO] - Extracted 1 expenses
2025-06-28 21:56:02,671 [INFO] -    Expense 1: Advertising - Meta Platforms Inc. - Instagram Post Campaign "Robot Eye is here! WOW technology" - 547 Impressions - A...
2025-06-28 21:56:02,671 [INFO] -    Amount: $11.22
2025-06-28 21:56:02,671 [INFO] -    Vendor: Meta Platforms Inc., formerly Facebook, Inc.
2025-06-28 21:56:02,672 [INFO] - 
2025-06-28 21:56:02,672 [INFO] - Returning response to TypeScript layer...
